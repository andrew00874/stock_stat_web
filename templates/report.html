<!DOCTYPE html>
<html lang="ko">
  <head>
    <meta charset="UTF-8" />
    <title>{{ data.ticker }} ì˜µì…˜ ë¶„ì„ ë¦¬í¬íŠ¸</title>
    <link rel="stylesheet" href="https://cdn.simplecss.org/simple.min.css" />
    <style>
      .grid-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 1rem;
        margin: 2rem 0;
      }
      .card {
        padding: 1.5rem;
        border: 1px solid var(--border);
        border-radius: var(--border-radius);
        text-align: center;
      }
      .card h3 {
        margin-top: 0;
      }
      .card .value {
        font-size: 2.5rem;
        font-weight: bold;
      }
      .chart-container {
        margin: 2rem 0;
      }
    </style>
    <script
      async
      src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3645359139957527"
      crossorigin="anonymous"
    ></script>
    <meta name="google-adsense-account" content="ca-pub-3645359139957527">
  </head>
  <body>
    <header>
      <h1>ğŸ“ˆ {{ data.ticker }} ì˜µì…˜ ë¶„ì„ ë¦¬í¬íŠ¸</h1>
      <h2>{{ data.strategy }}</h2>
      <p>
        <strong>ë§Œê¸°ì¼:</strong> {{ data.expiry_date }} |
        <strong>í˜„ì¬ê°€:</strong> ${{ data.current_price }}
      </p>
    </header>

    <main>
      <div class="grid-container">
        <div class="card">
          <h3>Put/Call Ratio</h3>
          <p class="value">{{ data.market_sentiment.put_call_ratio }}</p>
          <small>{{ data.market_sentiment.pcr_msg }}</small>
        </div>
        <div class="card">
          <h3>IV Skew</h3>
          <p class="value">{{ data.market_sentiment.iv_skew_percent }}%</p>
          <small>{{ data.market_sentiment.iv_skew_msg }}</small>
        </div>
        <div class="card">
          <h3>í‰ê·  ë³€ë™ì„±</h3>
          <p class="value">{{ data.market_sentiment.mean_iv_percent }}%</p>
          <small>{{ data.market_sentiment.mean_iv_msg }}</small>
        </div>
        <div class="card">
          <h3>ë°ì´í„° ì‹ ë¢°ë„</h3>
          <p class="value">{{ data.reliability.score }} / 1.0</p>
          <small>{{ data.reliability.message }}</small>
        </div>
      </div>
      <div class="chart-container">
        <h3>ë¯¸ê²°ì œì•½ì •(OI) ë° ê±°ë˜ëŸ‰(Volume) ë¶„í¬</h3>
        <p>
          <small
            >ğŸ’¡ <strong>ì‚¬ìš©ë²•:</strong> ë“œë˜ê·¸ë¡œ êµ¬ê°„ ì„ íƒ ì¤Œ, ë§ˆìš°ìŠ¤ íœ ë¡œ ì¤Œ,
            Shift+ë“œë˜ê·¸ë¡œ íŒ¨ë‹, ë”ë¸”í´ë¦­ìœ¼ë¡œ ë¦¬ì…‹</small
          >
        </p>
        <canvas id="oiVolumeChart"></canvas>
      </div>
      <div class="grid-container">
        <div class="card">
          <h3>ğŸ”¥ ê±°ë˜ëŸ‰ TOP ì½œ</h3>
          <p class="value">${{ data.top_options.call.strike }}</p>
          <p>
            Volume: {{ data.top_options.call.volume }} | OI:
            {{data.top_options.call.oi }}
          </p>
        </div>
        <div class="card">
          <h3>ğŸ”¥ ê±°ë˜ëŸ‰ TOP í’‹</h3>
          <p class="value">${{ data.top_options.put.strike }}</p>
          <p>
            Volume: {{ data.top_options.put.volume }} | OI:
            {{data.top_options.put.oi }}
          </p>
        </div>
        {% if data.box_range.min and data.box_range.max %}
        <div class="card" style="grid-column: 1 / -1">
          <h3>ğŸ“¦ ì˜ˆìƒ ë°•ìŠ¤ê¶Œ</h3>
          <p class="value">
            ${{ data.box_range.min }} ~ ${{ data.box_range.max }}
          </p>
        </div>
        {% endif %}
      </div>
      <a href="/">â†©ï¸ ë‹¤ë¥¸ í‹°ì»¤ ë¶„ì„í•˜ê¸°</a>
    </main>

    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-zoom@2.0.1/dist/chartjs-plugin-zoom.min.js"></script>
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const chartData = {{ data.chart_data | tojson }};
        const currentPrice = {{ data.current_price }};

          const ctx = document.getElementById('oiVolumeChart').getContext('2d');
          new Chart(ctx, {
              type: 'bar',
              data: {
                  labels: chartData.strikes,
                  datasets: [
                      {
                          label: 'ì½œ OI',
                          data: chartData.call_oi,
                          backgroundColor: 'rgba(75, 192, 192, 0.8)',
                          borderColor: 'rgb(75, 192, 192)',
                          yAxisID: 'y'
                      },
                      {
                          label: 'í’‹ OI',
                          data: chartData.put_oi,
                          backgroundColor: 'rgba(255, 99, 132, 0.8)',
                          borderColor: 'rgb(255, 99, 132)',
                          yAxisID: 'y'
                      },
                      {
                          label: 'ì½œ ê±°ë˜ëŸ‰',
                          data: chartData.call_volume,
                          type: 'line',
                          yAxisID: 'y1',
                          tension: 0.4,
                          borderColor: 'rgb(54, 162, 235)'
                      },
                      {
                          label: 'í’‹ ê±°ë˜ëŸ‰',
                          data: chartData.put_volume,
                          type: 'line',
                          yAxisID: 'y1',
                          tension: 0.4,
                          borderColor: 'rgb(255, 159, 64)'
                      }
                  ]
              },
              options: {
                  responsive: true,
                  interaction: {
                      mode: 'index',
                      intersect: false
                  },
                  scales: {
                      x: {
                          type: 'linear',
                          display: true,
                          stacked: true,
                          title: {
                              display: true,
                              text: 'í–‰ì‚¬ê°€ (Strike Price)'
                          }
                      },
                      y: {
                          type: 'linear',
                          display: true,
                          position: 'left',
                          title: {
                              display: true,
                              text: 'ë¯¸ê²°ì œì•½ì • (Open Interest)'
                          },
                          stacked: true
                      },
                      y1: {
                          type: 'linear',
                          display: true,
                          position: 'right',
                          grid: {
                              drawOnChartArea: false
                          },
                          title: {
                              display: true,
                              text: 'ê±°ë˜ëŸ‰ (Volume)'
                          }
                      }
                  },
                  plugins: {
                      tooltip: {
                          mode: 'index',
                          intersect: false
                      },
                      annotation: {
                          annotations: {
                              currentPriceLine: {
                                  type: 'line',
                                  xMin: currentPrice,
                                  xMax: currentPrice,
                                  borderColor: 'rgb(10, 90, 86, 0.8)',
                                  borderWidth: 3,
                                  label: {
                                    display: true,
                                    content: `í˜„ì¬ê°€: ${currentPrice}`,
                                    position: 'start',
                                    backgroundColor: 'rgba(255, 205, 86, 0.8)',
                                    color: 'black',
                                    font: {
                                        weight: 'bold',
                                        size: 12
                                    }
                                  }
                                }
                          }
                      },
                      zoom: {
                          pan: {
                              enabled: true,
                              mode: 'x',
                              modifierKey: 'shift',
                          },
                          zoom: {
                              wheel: {
                                  enabled: true,
                              },
                              pinch: {
                                  enabled: true
                              },
                              drag: {
                                  enabled: true,
                                  backgroundColor: 'rgba(54, 162, 235, 0.3)',
                                  borderColor: 'rgb(54, 162, 235)',
                                  borderWidth: 1,
                              },
                              mode: 'x',
                              onZoomComplete: function({chart}) {
                                  console.log('ì¤Œ ì™„ë£Œ:', chart.scales.x.min, chart.scales.x.max);
                              }
                          },
                          limits: {
                              x: {min: 'original', max: 'original'},
                              y: {min: 'original', max: 'original'},
                              y1: {min: 'original', max: 'original'}
                          }
                      }
                  }
              }
          });
      });
    </script>
  </body>
</html>
